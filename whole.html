<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CBD晚餐</title>
<link rel="stylesheet" href="/static/jquery/jquery.mobile-1.3.2.min.css">
<script src="/static/jquery/jquery-1.9.1.min.js"></script>
<script src="/static/jquery/jquery.mobile-1.3.2.min.js"></script>
</head>
<body>
<div data-role="page" id="home" data-title="CBD晚餐">
		<div data-role="header" data-position="inline" data-backbtn="false">
			<h1>CBD晚餐 首页</h1>
			<a href="#filters" data-icon="gear" class="ui-btn-right" data-transition="slide">筛选</a>
		</div>
		<div data-role="content">	
			<ul data-role="listview" data-inset="true" id="home_list">
				<li><a href="/profilet" user_id="">
					<img src="">
					<h2>Broken Bells</h2>
					<p>Broken Bells</p></a>
				</li>
				<li><a href="/profile/1">
					<img src="">
					<h2>董小姐</h2>
					<p>得一城终老，找一人白首</p></a>
				</li>
				<li><a href="/profilett">
					<img src="">
					<h2>Wolfgang Amadeus Phoenix</h2>
					<p>Phoenix</p></a>
				</li>
			</ul>
		</div>

		<div data-role="footer" data-position="fixed">
		   <div data-role="navbar">
						<ul>
								<li><a href="#home" data-transition="slide" data-direction="reverse">首页</a></li>
								<li><a href="" id="profile">个人信息</a></li>
								<li><a href="#about">关于</a></li>
								<!-- <li><a href="#persistentBar" class="ui-btn-active ui-state-persist">PersistentBar</a></li>-->
						</ul>
				</div><!-- /navbar -->
		</div>
</div>


<div data-role="page" id="filters">
	<div data-role="header" data-position="inline" data-backbtn="false">
		<h1>CBD晚餐 筛选条件</h1>
		<a href="#home" data-icon="check" class="ui-btn-right" data-transition="slide" data-direction="reverse">完成</a>
		<!--<input type="submit" id="btnFinished" value="完成" data-icon="check" class="ui-btn-right" />
		<span data-ajax="false" data-icon="check" class="ui-btn-right" data-role="button" id="finished">完成</span>-->
		
	</div>
	<div data-role="content">
					<label for="filters_gender"> 性别:</label>
					<select name="gender" id="filters_gender">
							<option value="全部" >全部</option>
							<option value="男" >男</option>
							<option value="女" >女</option>
					</select>

					<label for="filters_education"> 学历:</label>
					<select name="education" id="filters_education">
							<option value="全部" >全部</option>
							<option value="本科" >本科</option>
							<option value="硕士" >硕士</option>
							<option value="博士" >博士</option>
							<option value="海龟" >海龟</option>
					</select>

					<label for="filters_salary"> 薪水:</label>
					<select name="salary" id="filters_salary">
							<option value="全部" >全部</option>
							<option value="0-8000" >0-8000</option>
							<option value="8000-15000" >8000-15000</option>
							<option value="15000-25000" >15000-25000</option>
							<option value="25000以上" >25000以上</option>
					</select>
	</div>
	<!-- <input type="submit" id="btnFinished" value="完成" /> -->

	<div data-role="footer" data-position="fixed">
	   <div data-role="navbar">
					<ul>
							<li><a href="#home">首页</a></li>
							<li><a href="#profile">个人信息</a></li>
							<li><a href="#about">关于</a></li>
							<!-- <li><a href="#persistentBar" class="ui-btn-active ui-state-persist">PersistentBar</a></li>-->
					</ul>
			</div><!-- /navbar -->
	</div>
</div>





<!-- Start of second page -->
<div data-role="page" id="profile">

	<div data-role="header" data-position="inline" data-backbtn="true">
		<a href="#home" data-icon="back" data-direction="reverse" data-transition="slide">返回</a>
		<h1>CBD晚餐 个人资料</h1>
		<a href="/logout" data-icon="gear" class="ui-btn-right">收拢</a>
	</div>

	<div data-role="content">	
		<div data-role="collapsible" data-collapsed="false" data-content-theme="c">
			<h3>个人信息</h3>
			<p><lable>年龄：<lable/><lable for="age">29<lable/></p>
			<p><lable>婚姻状况：<lable/><lable for="marriage">否<lable/></p>
			<p><lable>籍贯：<lable/><lable for="birthPlace">湖北<lable/></p>
			<p><lable>邮箱：<lable/><lable for="email">test@gmail.com<lable/></p>
			<p><lable>联系方式：<lable/><lable for="phone">18709087891<lable/></p>
		</div>
		<div data-role="collapsible" data-collapsed="false" data-content-theme="c">
			<h3>教育经历</h3>
			<p><lable>学历：<lable/><lable for="age">本科<lable/></p>
			<p><lable>毕业院校：<lable/><lable for="age">武汉理工大学<lable/></p>
			<p><lable>专业：<lable/><lable for="age">电子商务<lable/></p>
		</div>
		<div data-role="collapsible" data-content-theme="c">
			<h3>工作背景</h3>
			<p><lable>行业：<lable/><lable for="age">金融<lable/></p>
			<p><lable>年薪：<lable/><lable for="age">1000000￥<lable/></p>
			<p><lable>公司：<lable/><lable for="age">北京尚科股份有限公司<lable/></p>
			<p><lable>公司地址：<lable/><lable for="age">北京市海淀区西平庄<lable/></p>
		</div>
		<div data-role="collapsible" data-content-theme="c">
			<h3>兴趣爱好</h3>
			<li>篮球、乒乓球</li>
			<li>爬山</li>
			<li>听音乐</li>
			<li>看电影</li>
			<li>跆拳道</li>
		</div>
		<div data-role="collapsible" data-content-theme="c">
			<h3>其她</h3>
			<p id="profile_intro">我永隔着遥远的距离梦中的小城让我在美好的日子里，遇见春暖花开红尘，隔着岁月的彼岸闲愁几许，岁月忽已晚花开花谢，刹那永恒秋韵阑珊，盈心此间阿莲我的爱情不是海千指百指弹，柔肠万转故秋情愫我是爸爸的包包转身，流年似水依依落雪，幽幽岁月百载春秋，眼睫匆匆浮尘在最美的年华里遇见你梅雪盛极，心络依依莲的心事回眸，忆千年，为你，倾一世不老的情</p>
		</div>
		<div data-role="collapsible" data-content-theme="c">
			<h3>开放晚餐时间</h3>
			<p>

		<ul data-role="listview">
			<li><a href="index.html">Inbox <span class="ui-li-count">12</span></a></li>
			<li><a href="index.html">Outbox <span class="ui-li-count">0</span></a></li>
			<li><a href="index.html">Drafts <span class="ui-li-count">4</span></a></li>
			<li><a href="index.html">Sent <span class="ui-li-count">328</span></a></li>
			<li><a href="index.html">Trash <span class="ui-li-count">62</span></a></li>
		</ul>
			
			</p>
		</div>

		</br>
		<ul data-role="listview">
			<li data-role="list-divider">A</li>
			<li><a href="index.html">Inbox <span class="ui-li-count">12</span></a></li>
			<li><a href="index.html">Outbox <span class="ui-li-count">0</span></a></li>
			<li><a href="index.html">Drafts <span class="ui-li-count">4</span></a></li>
			<li><a href="index.html">Sent <span class="ui-li-count">328</span></a></li>
			<li><a href="index.html">Trash <span class="ui-li-count">62</span></a></li>
		</ul>
		</br>
		</br>

		<ul data-role="listview" data-inset="true" data-icon="star">
			<li data-role="list-divider">Divider</li>
			<li><a href="index.html">Inbox <span class="ui-li-count">申请共进晚餐</span></a></li>
			<li><a href="index.html">Outbox <span class="ui-li-count">已申请</span></a></li>
			<li><a href="index.html">Sent <span class="ui-li-count">328</span></a></li>
		</ul>
		<a href="" data-role="button" id="profile_logout" data-theme="b">邀请与他一起晚餐</a>
		<a href="" data-role="button" id="profile_logout" data-theme="e">退出</a>
	</div><!-- /content -->

	<!-- <input type="submit" id="btnFinished" value="完成" /> -->
	<!--persistentBar-->
	<div data-role="footer" data-position="fixed">
	   <div data-role="navbar">
					<ul>
							<li><a href="#home">首页</a></li>
							<li><a href="#profile">个人信息</a></li>
							<li><a href="#about">关于</a></li>
							<!-- <li><a href="#persistentBar" class="ui-btn-active ui-state-persist">PersistentBar</a></li>-->
					</ul>
			</div>
	</div>
</div><!-- /page -->


<div data-role="page" id="login">

	<div data-role="header" data-position="inline" data-backbtn="false">
		<h1>CBD晚餐	登陆页面</h1>
		<a href="#register" data-icon="forward" class="ui-btn-right" data-transition="slide">注册</a>
	</div>
	<div data-role="content">	
	<form name="login_form" action="/login" method="post">
		<label for="login_username">用户名:</label>
		<input type="text" name="username" id="login_username" value="" />
		<label for="login_passwd">密码:</label>
		<input type="password" name="passwd" id="login_passwd" value="" />
		<input type="button" id="login_btnLogin"  value="登陆" />
	</form>
	</div>

	<div data-role="footer" data-position="fixed">
	   <div data-role="navbar">
					<ul>
							<li><a href="#home">首页</a></li>
							<li><a href="#profile">个人信息</a></li>
							<li><a href="#about">关于</a></li>
							<!-- <li><a href="#persistentBar" class="ui-btn-active ui-state-persist">PersistentBar</a></li>-->
					</ul>
		</div>
	</div>
</div><!-- /page -->





<!-- Start of second page -->
<div data-role="page" id="register">

	<div data-role="header">
		<h1>CBD晚餐	注册页面</h1>
		<a href="#login" data-icon="forward" class="ui-btn-right" data-transition="slide">登陆</a>
	</div><!-- /header -->

	<div data-role="content">	
		<label for="register_username">用户名:</label>
		<input type="text" name="username" id="register_username" value="" />
		<label for="register_passwd">密码:</label>
		<input type="password" name="passwd" id="register_passwd" value="" />
		<label for="register_passwd_confirm">密码确认 :</label>
		<input type="password" name="passwd_confirm" id="register_passwd_confirm" value="" />
		<input type="button" value="注册" id="register_btnRegister"/>
	</div><!-- /content -->

	<div data-role="footer">
	   <div data-role="navbar">
					<ul>
							<li><a href="#home">首页</a></li>
							<li><a href="#profile">个人信息</a></li>
							<li><a href="#about">关于</a></li>
							<!-- <li><a href="#persistentBar" class="ui-btn-active ui-state-persist">PersistentBar</a></li>-->
					</ul>
		</div>
	</div><!-- /header -->
</div><!-- /page -->






<!-- Start of second page -->
<div data-role="page" id="demo">

	<div data-role="header">
		<h1>Bar</h1>
	</div><!-- /header -->

	<div data-role="content">	
		<p>I'm first in the source order so I'm shown as the page.</p>		
		<p><a href="#foo">Back to foo</a></p>	
	</div><!-- /content -->

	<div data-role="footer">
		<h4>Page Footer</h4>
	</div><!-- /header -->
</div><!-- /page -->
</body>
</html>

<script type="text/javascript">
function fill_profile(user_id)
{
	//根据user_id,以及当前session状态从server端返回分级的用户数据和晚餐数据，抓取的数据保留到user_data一份做缓存(暂先不做)
	//填充到profile page,并转场到profile page
		$.getJSON('/profile/'+user_id, function(theback) {
			//var theback={msg:"ok"};

			if(theback.msg=='ok')
			{
				console.debug("profile page");
				console.debug(theback);
				//绑定theback.user所有属性
				$.each(theback.user,function(key,value){
					var id = "#profile_"+key;
					console.debug(id);
					if($(id).length)
					{
						$(id).html(value);
						console.debug("find");
					}
				
				})

				$.mobile.changePage( "#profile", {
					transition: "slide",
					reverse: false,
					changeHash: true
				});
				//$.mobile.navigate("#profile");
			}
			else
			{
				console.debug("register page");
				$.mobile.navigate("#login");
			}
		
		});
	
	
}



//$("div[data-role='page']").on('pageinit',function(event,ui){
function fill_home_list()
{
	$.post('/filters',{ 
		//参数一
		gender: $('#filters_gender').val(), 
		//参数二
		education: $("#filters_education").val(),
		//参数三
		salary: $("#filters_salary").val() 
	},
	//回调函数 
	function(theback) 
	{
	//	alert("hha");
		console.debug(theback);
		if (theback.msg == 'ok')
		{
			console.debug(theback.html);
			console.debug("=============");
			$("#home_list").html(theback.html);
			//var list = $(theback.html);
                        //$("#home_list").append(list).find("li:last").hide();  
                        $('#home_list').listview().listview('refresh');
			//$('ul').listview('refresh');  
                       // $("#home_list").find("li:last").slideDown(300);  
			//$('ul').listview('refresh');  
			//window.location.href="http://192.168.201.75/";
			//绑定事件
			$("#home_list a").on("click", function(){
				fill_profile($(this).attr("user_id"));
			});
		}
		else
		{
			alert(theback.msg);
		}
	},
	//返回类型
	"json"
	);
}


	$("#home").on( "pageshow", function( event, ui ) {
		//alert("haha");
		//console.log( "This page was just hidden: " + ui.prevPage );
		//console.debug( "This page was just hidden: " + ui.prevPage );
		if(ui.prevPage.length == 0 || ui.prevPage[0].id == "filters")
		{
			console.debug("fill_home_list");
			fill_home_list();		
		}
	//console.debug(ui.nextPage);
	});
	
	$("#profile").on("tap", function(event){
		event.preventDefault();
		$.getJSON('http://192.168.201.75/is_login', function(theback) {
			//var theback={msg:"ok"};

			if(theback.msg=='ok')
			{
				console.debug("profile page");
				$.mobile.changePage( "#profile", {
					transition: "slide",
					reverse: false,
					changeHash: true
				});
				//$.mobile.navigate("#profile");
			}
			else
			{
				console.debug("register page");
				$.mobile.navigate("#login");
			}
		
		});
	});
//});

	$("#login_btnLogin").click(function(){
		if ($("#login_username").val() == '' || $("#login_passwd").val()== '')
		{
			alert("用户名和密码均不能为空！");
			return ;
		}

		$.post('/login',{ 
			//参数一
			username: $('#login_username').val(), 
			//参数二
			passwd: $("#login_passwd").val() 
		},
		//回调函数 
		function(theback) 
		{
			//alert("hha");
			console.debug(theback);
			if (theback.msg == 'ok')
			{
				$.mobile.navigate("#profile");
			}
			else
			{
				alert(theback.msg);
			}
		},
		//返回类型
		"json"
		);
	});

	$("#profile_logout").click(function(){
		$.getJSON('/logout', function(theback) {

			if(theback.msg=='ok')
			{
				console.debug("profile page");
				$.mobile.navigate("#home");
			}
			else
			{
				console.debug("register page");
				$.mobile.navigate("#login");
			}
		
		});
		
	});

	$("#register_btnRegister").click(function(){
		if ($("#register_username").val() == '' || $("#register_passwd").val()== '')
		{
			alert("用户名和密码均不能为空！");
			return ;
		}
		if ($("#register_passwd").val() != $("#register_passwd_confirm").val())
		{
			alert("两次密码输入不一致！");
			return ;
		}

		$.post('/register',{ 
			//参数一
			username: $('#register_username').val(), 
			//参数二
			passwd: $("#register_passwd").val() 
		},
		//回调函数 
		function(theback) 
		{
			//alert("hha");
			console.debug(theback);
			if (theback.msg == 'ok')
			{
				$.mobile.navigate("#profile");
				//window.location.href="http://192.168.201.75/profile";
			}
			else
			{
				//TODO:display register error
				alert(theback.msg);
			}
		},
		//返回类型
		"json"
		);



	});



</script>
